---
title: "Bellabeat Data Analytics"
author: 'Mayssem Hannachi 2BD1 '
date: "2024-05-07"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section 1: Overview

### What is Bellbeat?

Bellabeat is a company that makes high-tech health products for women. By collecting data on activity, sleep, stress, and reproductive health, Bellabeat helps women understand their health and habits better.

Bellabeat plans to analyze data from smart device usage to see how people use non-Bellabeat devices. The findings will help shape Bellabeat's marketing strategies and spark new ideas for their products and services.

This case study will concentrate on enhancing Ivy, Bellabeat's wellness and health tracking device.

**Ivy -** A health tracker in the form of an elegant bracelet, monitoring not only activity, sleep, and stress but also heart rate, respiratory rate, cardiac coherence, and physical and mental activity.

#### Questions to Consider

This case study will address three key questions:

1.  What are the popular trends in smart device usage?

2.  How do these trends connect with Bellabeat's target audience?

3.  How can these trends shape Bellabeat's marketing approach?

## Section 2: Data Source

In this case study, we will use the FitBit Fitness Tracker Data available on Kaggle. This dataset was gathered from a survey on Amazon Mechanical Turk from March 12, 2016, to May 12, 2016. It includes detailed tracking data from 30 Fitbit users who agreed to share their minute-by-minute physical activity, heart rate, and sleep data. The data reveals patterns in daily activity, steps, and heart rate, highlighting user habits. The dataset consists of 18 CSV files, formatted in both long and wide styles.

The dataset contains data from only 30 participants, which may not fully represent the more than 31 million Fitbit users as of 2020. Although a sample size of 30 meets the minimum requirement under the Central Limit Theorem (CLT) to be considered valid, a larger sample would be preferable to enhance the reliability of the research findings.

## Section 3: Process

In this section, we will clean the selected data to make sure it is complete, accurate, and free from errors and outliers.

### 3.1 Installing and Loading Packages

First, we will install and then load the necessary packages to utilize their features for the analysis.

```{r}
# Set a CRAN mirror
options(repos = list(CRAN = "https://cloud.r-project.org/"))

# List of required packages
packages <- c("tidyverse", "dplyr", "readr", "janitor", "ggplot2", "lubridate", "skimr", "gridExtra")

# Function to check and install missing packages
check_and_install <- function(pkg){
  if (!require(pkg, character.only = TRUE)) {
    install.packages(pkg, dependencies = TRUE)
    library(pkg, character.only = TRUE)
  }
}

# Apply the function to each package
sapply(packages, check_and_install)


```

Check if all our packages have successfully been installed

```{r}
# List of packages you need
required_packages <- c("tidyverse", "dplyr", "readr", "janitor", "ggplot2", "lubridate", "skimr", "gridExtra")

# Check each package and print whether it is loaded successfully
sapply(required_packages, function(pkg) {
  if (!require(pkg, character.only = TRUE)) {
    cat("Package not installed:", pkg, "\n")
  } else {
    cat("Package loaded successfully:", pkg, "\n")
  }
})

```

----\> It appears that all the required packages are successfully loaded into our R environment.

### 3.2 Importing Datasets and Assigning New Names

```{r}
daily_activity <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/dailyActivity_merged.csv")
daily_calories <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/dailyCalories_merged.csv")
daily_intensities <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/dailyIntensities_merged.csv")
daily_steps <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/dailySteps_merged.csv")
daily_sleep <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/sleepDay_merged.csv")
heartrate_seconds <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/heartrate_seconds_merged.csv")
hourly_calories <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/hourlyCalories_merged.csv")
hourly_intensities <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/hourlyIntensities_merged.csv")
hourly_steps <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/hourlySteps_merged.csv")
minute_calories_narrow <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteCaloriesNarrow_merged.csv")
minute_calories_wide <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteCaloriesWide_merged.csv")
minute_intensities_narrow <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteIntensitiesNarrow_merged.csv")
minute_intensities_wide <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteIntensitiesWide_merged.csv")
minute_METs_narrow <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteMETsNarrow_merged.csv")
minute_sleep <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteSleep_merged.csv")
minute_steps_narrow <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteStepsNarrow_merged.csv")
minute_steps_wide <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/minuteStepsWide_merged.csv")
weight_log_info <- read_csv("/Users/macbookair/Documents/ISAMM/sem2/R/Bellabeat Case Study Project/Fitabase Data 4.12.16-5.12.16/weightLogInfo_merged.csv")
```

### 3.3 Exploring the Datasets

To get a quick idea of what is in the datasets, the glimpse() function will be used. The datasets will be divided into daily, hourly, minute, and second dataframes.

#### Daily DataFrames

```{r}
# A quick preview of Daily Datasets
print("-----Daily Activity-----")
glimpse(daily_activity)

print("-----Daily Calories-----")
glimpse(daily_calories)

print("-----Daily Intensities-----")
glimpse(daily_intensities)

print("-----Daily Steps-----")
glimpse(daily_steps)

print("-----Daily Sleep-----")
glimpse(daily_sleep)

print("-----Weight Log Info-----")
glimpse(weight_log_info)
```

#### Hourly DataFrames

```{r}
# A quick preview of Hourly Datasets
print("-----Hourly Calories-----")
glimpse(hourly_calories)

print("-----Hourly Intensities-----")
glimpse(hourly_intensities)

print("-----Hourly Steps-----")
glimpse(hourly_steps)
```

#### Minute DataFrames

```{r}
# A quick preview of Minute Datasets
print("-----Minute Calories-----")
glimpse(minute_calories_narrow)

print("-----Minute Intensities-----")
glimpse(minute_intensities_narrow)

print("-----Minute METs-----")
glimpse(minute_METs_narrow)

print("-----Minute Sleep-----")
glimpse(minute_sleep)

print("-----Minute Steps-----")
glimpse(minute_steps_narrow)
```

#### Second DataFrame

```{r}
# A quick preview of Second Datasets
print("-----Heartrate Seconds-----")
glimpse(heartrate_seconds)
```

### 3.4 Data Cleaning

After exploring the datasets, various data integrity issues have been identified, highlighting the need for thorough data cleaning measures. This process is essential to ensure the quality and accuracy of the data before proceeding with any further analysis.

#### 3.4.1 Standardizing Naming Conventions and Formatting Date Variables

1.  **Issue: Inconsistent Naming Conventions**
    -   The problem identified here is that there is inconsistency in how names are formatted in the dataframes. Naming conventions are important because they help in maintaining uniformity and clarity in code, making it easier to read and manage. In this case, most of the dataframe names are in "UpperCamelCase" format. This format starts each new word with a capital letter and joins them without spaces, like `UpperCamelCase`.
    -   However, the name "minute_sleep" breaks this pattern by using a mix of UpperCamelCase ("minute") and lowercase ("sleep") formats.
    -   the issue can be seen when we ran the command `glimpse(minute_sleep)`

----\> **Solution: Standardizing Variable Names** - To resolve the inconsistency, the proposed solution is to use the `clean_names()` function. This function is typically used to standardize the naming format of variables across all dataframes by converting them to a consistent format. - The chosen format for standardization is "snake_case". In snake_case format, words are typically all lowercase and separated by underscores, like `snake_case`.

2.  **Issue: Different Names for Variables with the Same Meaning**
    -   In the described scenario, although most of the variable names are consistent across the dataframes (like "Id"), the variables that represent dates are named differently in each dataframe. Examples given include "ActivityDate," "ActivityDay," and "Time." These variations can create confusion and complicate data processing tasks such as merging dataframes, as each dataframe refers to the date with a different title.

----\> **Solution: Standardizing Variable Names** - To address this inconsistency, the solution is to rename these variables so that they all have the same title. Specifically, the variables "ActivityDate," "ActivityDay," and "Time" will all be renamed to "activity_date." - Choosing "activity_date" as a standard name for all date columns across the datasets ensures uniformity. This standardization is particularly helpful when performing data merging. When datasets are merged, it is essential that the corresponding columns that are supposed to be identical across tables are indeed identical in name and format. By standardizing the date columns to "activity_date," it ensures that when the datasets are combined, there will be no ambiguity or error in aligning data related to dates.

3.  **Issue: Date Column's char Format**

-Right now, the date information in the column is saved as text, which makes it hard to work with. To fix this, we'll make new columns where the dates will be changed into standard date or date-time formats using the `mdy()` and `mdy_hms()` functions. This will make sure the dates look the same across all the datasets.

##### Daily DataFrames

**1. Load and Clean Daily Activity Data**

```{r}
# Load daily_activity data and standardize column names to lowercase with underscores using clean_names()
clean_daily_activity <- daily_activity %>% clean_names() 
# Convert the activity_date column from MM/DD/YYYY format to a Date object
clean_daily_activity$activity_date_ymd <- mdy(clean_daily_activity$activity_date)
# Print the structure of the cleaned daily activity data
print("-----Clean Daily Activity-----")
glimpse(clean_daily_activity)

```

**2. Load and Clean Daily Calories Data**

```{r}
# Load daily_calories data, rename ActivityDay column to activity_date, and clean column names
clean_daily_calories <- daily_calories %>% 
    rename(activity_date = ActivityDay) %>% 
    clean_names()
# Convert the activity_date column to a Date object
clean_daily_calories$activity_date_ymd <- mdy(clean_daily_calories$activity_date)
# Print the structure of the cleaned daily calories data
print("-----Clean Daily Calories-----")
glimpse(clean_daily_calories)

```

**3. Load and Clean Daily Intensities Data**

```{r}
# Similar to daily calories, rename and clean columns
clean_daily_intensities <- daily_intensities %>% 
    rename(activity_date = ActivityDay) %>% 
    clean_names()
# Convert date from string to Date object
clean_daily_intensities$activity_date_ymd <- mdy(clean_daily_intensities$activity_date)
# Print the structure of cleaned data
print("-----Clean Daily Intensities-----")
glimpse(clean_daily_intensities)

```

**4. Load and Clean Daily Steps Data**

```{r}
# Load daily_steps, rename ActivityDay and StepTotal, and clean names
clean_daily_steps <- daily_steps %>% 
    rename(activity_date = ActivityDay,
           total_steps = StepTotal) %>% 
    clean_names()
# Convert the activity_date to a Date object
clean_daily_steps$activity_date_ymd <- mdy(clean_daily_steps$activity_date)
# Print the structure of the cleaned data
print("-----Clean Daily Steps-----")
glimpse(clean_daily_steps)

```

**5. Load and Clean Daily Sleep Data**

```{r}
# Rename and clean daily_sleep data, considering sleep dates might include time
clean_daily_sleep <- daily_sleep %>% 
    rename(activity_date = SleepDay) %>% 
    clean_names() 
# Convert the activity_date to a datetime object, considering possible time and timezone
clean_daily_sleep$activity_date_ymd <- mdy_hms(clean_daily_sleep$activity_date, tz=Sys.timezone())
# Print the structure of the cleaned sleep data
print("-----Clean Daily Sleep-----")
glimpse(clean_daily_sleep)

```

**6. Load and Clean Weight Log Data**

```{r}
# Rename, reformat, and clean the weight_log_info data
clean_weight_log_info <- weight_log_info %>% 
    rename(activity_date = Date,
           weight_kg = WeightKg,
           weight_lb = WeightPounds,
           manual_report = IsManualReport) %>% 
    clean_names()
# Convert the activity_date to a datetime object considering timezone
clean_weight_log_info$activity_date_ymdhms <- mdy_hms(clean_weight_log_info$activity_date, tz=Sys.timezone())
# Print the structure of the cleaned weight log data
print("-----Clean Weight Log Info-----")
glimpse(clean_weight_log_info)

```

##### Hourly DataFrames

**1. Cleaning Hourly Calories Data**

```{r}
# Load hourly_calories data and standardize column names using clean_names(), which converts all column names to lowercase with underscores.
clean_hourly_calories <- hourly_calories %>% 
  clean_names()
# Convert the activity_hour column from a string to a POSIXct datetime object, which includes date and time, adjusting for the system's timezone.
clean_hourly_calories$activity_hour_ymdhms <- mdy_hms(clean_hourly_calories$activity_hour, tz=Sys.timezone())
# Print a statement to indicate the clean state of the data.
print("-----Clean Hourly Calories-----")
# Use glimpse() to provide a concise summary of the dataframe, displaying the structure and a preview of the data.
glimpse(clean_hourly_calories)

```

**2. Cleaning Hourly Intensities Data**

```{r}
# Load hourly_intensities data and apply clean_names() for consistent naming.
clean_hourly_intensities <- hourly_intensities %>% 
  clean_names()
# Convert the activity_hour field from a string to a datetime object, applying the system's timezone setting for correct time representation.
clean_hourly_intensities$activity_hour_ymdhms <- mdy_hms(clean_hourly_intensities$activity_hour, tz=Sys.timezone())
# Print a header for clarity when viewing output.
print("-----Clean Hourly Intensities-----")
# Output the structure of the cleaned data to check the changes and ensure correct formatting.
glimpse(clean_hourly_intensities)

```

**3. Cleaning Hourly Steps Data**

```{r}
# Load hourly_steps, renaming StepTotal to total_steps for consistency, then apply clean_names() to all column names.
clean_hourly_steps <- hourly_steps %>% 
  rename(total_steps = StepTotal) %>% 
  clean_names()
# Convert the activity_hour column into a datetime object with the correct timezone.
clean_hourly_steps$activity_hour_ymdhms <- mdy_hms(clean_hourly_steps$activity_hour, tz=Sys.timezone())
# Print a descriptive message to indicate the completion of cleaning for this specific dataframe.
print("-----Clean Hourly Steps-----")
# Display the structure and partial contents of the dataframe to verify column names and types.
glimpse(clean_hourly_steps)

```

##### Minute DataFrames

**1. Cleaning Minute-Level Calories Data**

```{r}
# Load minute_calories_narrow data and standardize column names to be more consistent and easier to handle
clean_minute_calories <- minute_calories_narrow %>% 
  clean_names()
# Convert the activity_minute column from string format to a POSIXct datetime object considering the system's timezone
clean_minute_calories$activity_minute_ymdhms <- mdy_hms(clean_minute_calories$activity_minute, tz=Sys.timezone())
# Print a statement indicating the dataset being cleaned
print("-----Clean Minute Calories-----")
# Display the structure and a brief preview of the data
glimpse(clean_minute_calories)

```

**2. Cleaning Minute-Level Intensities Data**

```{r}
# Standardize column names for the minute_intensities_narrow dataset
clean_minute_intensities <- minute_intensities_narrow %>% 
  clean_names()
# Convert the datetime information into a properly formatted datetime object
clean_minute_intensities$activity_minute_ymdhms <- mdy_hms(clean_minute_intensities$activity_minute, tz=Sys.timezone())
# Output the cleaning status
print("-----Clean Minute Intensities-----")
# Use glimpse to view the structure and confirm changes
glimpse(clean_minute_intensities)

```

**3. Cleaning Minute-Level METs Data**

```{r}
# Load minute_METs_narrow data, rename the METs column for clarity, and clean all column names
clean_minute_METs <- minute_METs_narrow %>% 
  rename(mets = METs) %>% 
  clean_names()
# Adjust the datetime column for timezone correctness
clean_minute_METs$activity_minute_ymdhms <- mdy_hms(clean_minute_METs$activity_minute, tz=Sys.timezone())
# Print a clean data statement
print("-----Clean Minute METs-----")
# Check the structure of the cleaned data
glimpse(clean_minute_METs)

```

**4. Cleaning Minute-Level Sleep Data**

```{r}
# Rename and clean columns in the minute_sleep dataframe for consistency
clean_minute_sleep <- minute_sleep %>% 
  rename(activity_minute = date,
         sleep_state = value) %>% 
  clean_names()
# Format the activity_minute column as a datetime object with appropriate timezone
clean_minute_sleep$activity_minute_ymdhms <- mdy_hms(clean_minute_sleep$activity_minute, tz=Sys.timezone())
# Indicate the dataset being cleaned
print("-----Clean Minute Sleep-----")
# Display the structure to confirm changes
glimpse(clean_minute_sleep)

```

**4. Cleaning Minute-Level Steps Data**

```{r}
# Rename the Steps column to total_steps and apply standard naming conventions
clean_minute_steps <- minute_steps_narrow %>% 
  rename(total_steps = Steps) %>% 
  clean_names()
# Convert the time string to a datetime object including timezone adjustments
clean_minute_steps$activity_minute_ymdhms <- mdy_hms(clean_minute_steps$activity_minute, tz=Sys.timezone())
# Announce the cleaned data
print("-----Clean Minute Steps-----")
# Preview the dataframe's structure post-cleaning
glimpse(clean_minute_steps)

```

##### Second DataFrames

```{r}
# Clean the heartrate_seconds DataFrame
clean_heartrate_seconds <- heartrate_seconds %>%
  # Renaming columns for clarity and ease of understanding
  rename(activity_second = Time,     # Renames 'Time' to 'activity_second' for better context
         heartrate = Value) %>%      # Renames 'Value' to 'heartrate' to clearly indicate the data it represents
  # Standardize all column names to lower case and replace spaces with underscores
  clean_names() %>%
  # Convert the activity_second column from string format to a POSIXct datetime object
  # The timezone is set to the system's current timezone for accurate time representation
  mutate(activity_second_ymdhms = mdy_hms(activity_second, tz = Sys.timezone()))

# Print a message indicating that the cleaning process is complete
print("-----Clean Heartrate Seconds-----")

# Use glimpse() to provide a quick overview of the dataframe structure,
# confirming that columns have been renamed and datetime formatting applied correctly
glimpse(clean_heartrate_seconds)
```

#### 3.4.2 Unique Participant IDs

To confirm the consistency of the data, it is essential to verify that each dataset includes 30 unique participant IDs as indicated in the data description. This will be done by applying the `n_unique()` function to count and check the number of unique participants in each dataset.

##### Daily DataFrames

```{r}
# Unique participant IDs: Daily DataFrames
print("Daily Activity")
n_unique(clean_daily_activity$id)

print("Daily Calories")
n_unique(clean_daily_calories$id)

print("Daily Intensities")
n_unique(clean_daily_intensities$id)

print("Daily Steps")
n_unique(clean_daily_steps$id)

print("Daily Sleep")
n_unique(clean_daily_sleep$id)

print("Daily Weight Log Info")
n_unique(clean_weight_log_info$id)
```

##### Hourly DataFrames

```{r}
# Unique participant IDs: Hourly DataFrames
print("Hourly Calories")
n_unique(clean_hourly_calories$id)

print("Hourly Intensities")
n_unique(clean_hourly_intensities$id)

print("Hourly Steps")
n_unique(clean_hourly_steps$id)
```

##### Minute DataFrames

```{r}
# Unique participant IDs: Minute DataFrames
print("Minute Calories")
n_unique(clean_minute_calories$id)

print("Minute Intensities")
n_unique(clean_minute_intensities$id)

print("Minute METs")
n_unique(clean_minute_METs$id)

print("Minute Sleep")
n_unique(clean_minute_sleep$id)

print("Minute Steps")
n_unique(clean_minute_steps$id)
```

##### Second DataFrames

```{r}
# Unique participant IDs: Second DataFrame
print("Second Heartrate")
n_unique(clean_heartrate_seconds$id)
```

##### Observation

The examination of the data reveals a significant inconsistency with the expected number of participant IDs. While the data description specifies each dataset should contain 30 unique IDs, the majority of the datasets actually contain 33 distinct IDs, indicating an excess of three participants. Additionally, there are notable exceptions in the sleep, weight, and heart rate datasets, which contain only 24, 8, and 14 unique IDs respectively. This variation suggests these datasets are incomplete.

The observed discrepancies could be attributed to differences in how data is collected and recorded: 

- **Activity data**, which generally show higher participant counts, are likely recorded automatically by the device through sensors detecting movement.

- **Weight data**, which significantly lacks participant representation, require manual input by the users into their Fitbit devices, suggesting that many participants did not consistently enter this information. 

- **Heart rate data**, also showing lower numbers of participants, might necessitate active user engagement to initiate tracking, which may not always be consistently performed by all users.

This analysis indicates that the completeness of each dataset is dependent on both the nature of the data collection method and participant compliance with using the deviceâ€™s features.

##### Actions Taken

-   Given the limited participant counts in the weight (8) and heart datasets (14), these datasets will be excluded from further analysis as the sample size is not significant enough to make any conclusions.

#### Number of Active Days:

Each dataset is expected to span 31 days. To confirm this, the number of active days in each dataset will be assessed using the n_unique() function.

##### Daily DataFrames

```{r}
# Unique number of active days: Daily DataFrames
print("Daily Activity")
n_unique(clean_daily_activity$activity_date_ymd)

print("Daily Calories")
n_unique(clean_daily_calories$activity_date_ymd)

print("Daily Intensities")
n_unique(clean_daily_intensities$activity_date_ymd)

print("Daily Steps")
n_unique(clean_daily_steps$activity_date_ymd)

print("Daily Sleep")
n_unique(clean_daily_sleep$activity_date_ymd)
```

##### Hourly DataFrames

```{r}
# Unique number of active days: Hourly DataFrames
print("Hourly Calories")
n_unique(date(clean_hourly_calories$activity_hour_ymdhms))

print("Hourly Intensities")
n_unique(date(clean_hourly_intensities$activity_hour_ymdhms))

print("Hourly Steps")
n_unique(date(clean_hourly_steps$activity_hour_ymdhms))
```

##### Minute DataFrames

```{r}
# Unique number of active days: Minute DataFrames
print("Minute Calories")
n_unique(date(clean_minute_calories$activity_minute_ymdhms))

print("Minute Intensities")
n_unique(date(clean_minute_intensities$activity_minute_ymdhms))

print("Minute METs")
n_unique(date(clean_minute_METs$activity_minute_ymdhms))

print("Minute Sleep")
n_unique(date(clean_minute_sleep$activity_minute_ymdhms))

print("Minute Steps")
n_unique(date(clean_minute_steps$activity_minute_ymdhms))
```

##### Observation

Most datasets exhibit 31 active days, aligning with the expected duration of the research period. However, the "minute_sleep" dataset displays 32 active days. The research was supposed to start on 04/12/2016 and end 05/12/2016 (= 31 days). However, some participants went to bed before 12am on 04/11/2016; therefore, that date was also included in the data, amounting to 32 days.

#### 3.4.4 Participants' Logged Activity

To ensure participant engagement throughout the entire 31-day research period, the number of logged activities will be examined.

```{r}
clean_daily_activity %>% 
  group_by(id) %>% 
  count() %>% 
  arrange(n) %>% 
  tibble() %>% 
  print(n=33)
```

##### Observation

Participant with ID# 4057192912 has only 4 logged activities, which is significantly low. Although considering removal, given the already limited participant pool, the participant's data will be kept.

#### Missing Values

The number of missing values in each dataset will be examined using the `sum(is.na(x))` and `which(is.na(x))` functions.

##### Daily DataFrames

```{r}
# Checking for missing values: Daily DataFrames
print ("-----Daily Activity-----")
if (sum(is.na(clean_daily_activity)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_daily_activity))
} else {
  print("No missing values")
}

print("-----Daily Calories-----")
if (sum(is.na(clean_daily_calories)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_daily_calories))
} else {
  print("No missing values")
}

print("-----Daily Intensities-----")
if (sum(is.na(clean_daily_intensities)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_daily_intensities))
} else {
  print("No missing values")
}

print("-----Daily Steps-----")
if (sum(is.na(clean_daily_steps)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_daily_steps))
} else {
  print("No missing values")
}

print("-----Daily Sleep-----")
if (sum(is.na(clean_daily_sleep)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_daily_sleep))
} else {
  print("No missing values")
}
```

##### Hourly DataFrames

```{r}
# Checking for missing values: Hourly DataFrames
print("-----Hourly Calories-----")
if (sum(is.na(clean_hourly_calories)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_hourly_calories))
} else {
  print("No missing values")
}

print("-----Hourly Intensities-----")
if (sum(is.na(clean_hourly_intensities)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_hourly_intensities))
} else {
  print("No missing values")
}

print("-----Hourly Steps-----")
if (sum(is.na(clean_hourly_steps)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_hourly_steps))
} else {
  print("No missing values")
}
```

##### Minute DataFrames

```{r}
# Checking for missing values: Minute DataFrames
print("-----Minute Calories-----")
if (sum(is.na(clean_minute_calories)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_minute_calories))
} else {
  print("No missing values")
}

print("-----Minute Intensities-----")
if (sum(is.na(clean_minute_intensities)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_minute_intensities))
} else {
  print("No missing values")
}

print("-----Minute METs-----")
if (sum(is.na(clean_minute_METs)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_minute_METs))
} else {
  print("No missing values")
}

print("-----Minute Sleep-----")
if (sum(is.na(clean_minute_sleep)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_minute_sleep))
} else {
  print("No missing values")
}

print("-----Minute Steps-----")
if (sum(is.na(clean_minute_steps)) !=0) {
  print("Position of missing values - ")
  which(is.na(clean_minute_steps))
} else {
  print("No missing values")
}
```

##### Observation

There are no missing values.

#### 3.4.5 Removing Duplicates

Duplicate data can cause inaccurate reporting. To find out if there are any duplicates, the `sum(duplicated())` function will be used.

##### Daily DataFrames

```{r}
# Checking for duplicates: Daily DataFrames
print("Daily Activity")
sum(duplicated(clean_daily_activity))

print("Daily Calories")
sum(duplicated(clean_daily_calories))

print("Daily Intensities")
sum(duplicated(clean_daily_intensities))

print("Daily Steps")
sum(duplicated(clean_daily_steps))

print("Daily Sleep")
sum(duplicated(clean_daily_sleep))
```

##### Hourly DataFrames

```{r}
# Checking for duplicates: Hourly DataFrames
print("Hourly Calories")
sum(duplicated(clean_hourly_calories))

print("Hourly Intensities")
sum(duplicated(clean_hourly_intensities))

print("Hourly Steps")
sum(duplicated(clean_hourly_steps))
```

##### Minute DataFrames

```{r}
# Checking for duplicates: Minute DataFrames
print("Minute Calories")
sum(duplicated(clean_minute_calories))

print("Minute Intensities")
sum(duplicated(clean_minute_intensities))

print("Minute METs")
sum(duplicated(clean_minute_METs))

print("Minute Sleep")
sum(duplicated(clean_minute_sleep))

print("Minute Steps")
sum(duplicated(clean_minute_steps))
```
##### Observation
Duplicates have been identified in the "daily_sleep" and "minute_sleep" dataframes.

#####Actions Taken
To remove these duplicates, the !duplicated() function will be used.

```{r}
# Removing duplicates from the "Daily Sleep" DataFrame
clean_daily_sleep <- clean_daily_sleep[!duplicated(clean_daily_sleep),]
# Checking if the duplicates are removed from the "Daily Sleep" DataFrame
print("Daily Sleep clean of duplicates")
sum(duplicated(clean_daily_sleep))

# Removing duplicates from the "Minute Sleep" DataFrame
clean_minute_sleep <- clean_minute_sleep[!duplicated(clean_minute_sleep),]
# Checking if the duplicates are removed from the "Minute Sleep" DataFrame
print("Minute Sleep clean of duplicates")
sum(duplicated(clean_minute_sleep))
```


#### 3.5 Adding 'weekday' Column

In order to facilitate analysis regarding participant activity levels on specific days, a "weekday" column will be incorporated into all Daily DataFrames and some Hourly DataFrames.

```{r}
# Adding the "weekday" column
clean_daily_activity$weekday <- weekdays(as.Date(clean_daily_activity$activity_date_ymd))
print("Daily Activity")
glimpse(clean_daily_activity)

clean_daily_calories$weekday <- weekdays(as.Date(clean_daily_calories$activity_date_ymd))
print("Daily Calories")
glimpse(clean_daily_calories)

clean_daily_intensities$weekday <- weekdays(as.Date(clean_daily_intensities$activity_date_ymd))
print("Daily Intensities")
glimpse(clean_daily_intensities)

clean_daily_steps$weekday <- weekdays(as.Date(clean_daily_steps$activity_date_ymd))
print("Daily Steps")
glimpse(clean_daily_steps)

clean_daily_sleep$weekday <- weekdays(as.Date(clean_daily_sleep$activity_date_ymd))
print("Daily Sleep")
glimpse(clean_daily_sleep)

clean_hourly_intensities$weekday <- weekdays(as.Date(clean_hourly_intensities$activity_hour_ymdhms))
print("Daily Sleep")
glimpse(clean_hourly_intensities)
```

#### 3.6 Merging Datasets

Upon examination, it was noted that the daily_activity dataframe contains the same variables and attributes present in the daily_calories, daily_intensities, and daily_steps dataframes. However, to make sure that those variables are identical, the all.equal() function will be used. Identical columns will be checked in all dataframes to identify if any of them can be merged.

##### Daily DataFrames

```{r}
# Checking if columns are identical: Daily DataFrames
print("-----Daily Activity, Daily Calories-----")
if (all.equal(clean_daily_activity$id, clean_daily_calories$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_daily_activity$activity_date, clean_daily_calories$activity_date) !=0) {
  print("Activity Date: identical")
}
if (all.equal(clean_daily_activity$calories, clean_daily_calories$calories) !=0) {
  print("Calories: identical")
}
if (all.equal(clean_daily_activity$weekday, clean_daily_calories$weekday) !=0) {
  print("Weekday: identical")
}

print("-----Daily Activity, Daily Intensities-----")
if (all.equal(clean_daily_activity$id, clean_daily_intensities$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_daily_activity$activity_date, clean_daily_intensities$activity_date) !=0) {
  print("Activity Date: identical")
}
if (all.equal(clean_daily_activity$sedentary_minutes, clean_daily_intensities$sedentary_minutes) !=0) {
  print("Sedentary Minutes: identical")
}
if (all.equal(clean_daily_activity$lightly_active_minutes, clean_daily_intensities$lightly_active_minutes) !=0) {
  print("Lightly Active Minutes: identical")
}
if (all.equal(clean_daily_activity$fairly_active_minutes, clean_daily_intensities$fairly_active_minutes) !=0) {
  print("Fairly Active Minutes: identical")
}
if (all.equal(clean_daily_activity$very_active_minutes, clean_daily_intensities$very_active_minutes) !=0) {
  print("Very Active Minutes: identical")
}
if (all.equal(clean_daily_activity$sedentary_active_distance, clean_daily_intensities$sedentary_active_distance) !=0) {
  print("Sedentary Active Distance: identical")
}
if (all.equal(clean_daily_activity$light_active_distance, clean_daily_intensities$light_active_distance) !=0) {
  print("Light Active Distance: identical")
}
if (all.equal(clean_daily_activity$moderately_active_distance, clean_daily_intensities$moderately_active_distance) !=0) {
  print("Moderately Active Distance: identical")
}
if (all.equal(clean_daily_activity$very_active_distance, clean_daily_intensities$very_active_distance) !=0) {
  print("Very Active Distance: identical")
}
if (all.equal(clean_daily_activity$weekday, clean_daily_intensities$weekday) !=0) {
  print("Weekday: identical")
}


print("-----Daily Activity, Daily Steps-----")
if (all.equal(clean_daily_activity$id, clean_daily_steps$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_daily_activity$activity_date, clean_daily_steps$activity_date) !=0) {
  print("Activity Date: identical")
}
if (all.equal(clean_daily_activity$total_steps, clean_daily_steps$total_steps) !=0) {
  print("Total Steps: identical")
}
if (all.equal(clean_daily_activity$weekday, clean_daily_steps$weekday) !=0) {
  print("Weekday: identical")
}
```

##### Hourly DataFrames

```{r}
# Checking if columns are identical: Hourly DataFrames
print("-----Hourly Calories, Hourly Intensities-----")
if (all.equal(clean_hourly_calories$id, clean_hourly_intensities$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_hourly_calories$activity_hour, clean_hourly_intensities$activity_hour) !=0) {
  print("Activity Hour: identical")
}

print("-----Hourly Calories, Hourly Steps-----")
if (all.equal(clean_hourly_calories$id, clean_hourly_steps$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_hourly_calories$activity_hour, clean_hourly_steps$activity_hour) !=0) {
  print("Activity Hour: identical")
}
```

##### Minute DataFrames

```{r}
# Checking if columns are identical: Minute DataFrames
print("-----Minute Calories, Minute Intensities-----")
if (all.equal(clean_minute_calories$id, clean_minute_intensities$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_minute_calories$activity_minute, clean_minute_intensities$activity_minute) !=0) {
  print("Activity Minute: identical")
}

print("-----Minute Calories, Minute METs-----")
if (all.equal(clean_minute_calories$id, clean_minute_METs$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_minute_calories$activity_minute, clean_minute_METs$activity_minute) !=0) {
  print("Activity Minute: identical")
}

print("-----Minute Calories, Minute Sleep-----")
if (all.equal(clean_minute_calories$id, clean_minute_sleep$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_minute_sleep$activity_minute, clean_minute_sleep$activity_minute) !=0) {
  print("Activity Minute: identical")
}

print("-----Minute Calories, Minute Steps-----")
if (all.equal(clean_minute_calories$id, clean_minute_steps$id) !=0) {
  print("Id: identical")
}
if (all.equal(clean_minute_steps$activity_minute, clean_minute_steps$activity_minute) !=0) {
  print("Activity Minute: identical")
}
```

##### Actions Taken

In terms of Daily DataFrames, because data in daily_calories, daily_intensities, and daily_steps is already aggregated within the daily_activity dataframe, only the daily_activity and daily_sleep dataframes will be merged. With regard to Hourly DataFrames, all of them will be merged into one big dataframe. The same will be done with the Minute DataFrames.

##### Daily DataFrames

```{r}
# Merging data: Daily DataFrames
daily_activity_merged <- merge(clean_daily_activity, clean_daily_sleep, by=c("id", "activity_date_ymd", "weekday"), all = TRUE, no.dups = TRUE)
glimpse(daily_activity_merged)
```

##### Hourly DataFrames

```{r}
# Merging data: Hourly DataFrames
hourly_activity_m <- merge(clean_hourly_calories, clean_hourly_intensities, by=c("id", "activity_hour", "activity_hour_ymdhms"), all = TRUE, no.dups = TRUE)
hourly_activity_merged <- merge(hourly_activity_m, clean_hourly_steps, by=c("id", "activity_hour", "activity_hour_ymdhms"), all = TRUE, no.dups = TRUE)
glimpse(hourly_activity_merged)
```

##### Minute DataFrames

```{r}
# Merging data: Minute DataFrames
minute_activity_m <- merge(clean_minute_calories,clean_minute_intensities, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
minute_activity_m1 <- merge(minute_activity_m, clean_minute_METs, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
minute_activity_m2 <- merge(minute_activity_m1, clean_minute_sleep, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
minute_activity_merged <- merge(minute_activity_m2, clean_minute_steps, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
glimpse(minute_activity_merged)
```

#### 3.7 Summary of the Datasets

Summarising all the datasets will provide an overview and reveal any other errors or outliers that were missed in the previous sections.

```{r}
# Summary of Daily DataFrames
print("-----Daily Calories-----")
clean_daily_calories %>% 
  select(calories) %>% 
  summary()

print("-----Daily Intensities-----")
clean_daily_intensities %>% 
  select(sedentary_minutes, lightly_active_minutes, fairly_active_minutes, very_active_minutes) %>% 
  summary()
  
clean_daily_intensities %>% 
  select(sedentary_active_distance) %>% 
  summary()

print("-----Daily Steps-----")
clean_daily_steps %>% 
  select(total_steps) %>% 
  summary()

print("-----Daily Sleep-----")
clean_daily_sleep %>% 
  select(total_sleep_records, total_minutes_asleep, total_time_in_bed) %>% 
  summary()
```

##### Hourly DataFrames

```{r}
# Summary of Hourly DataFrames
print("-----Hourly Calories-----")
hourly_activity_merged %>% 
  select(calories) %>% 
  drop_na() %>% 
  summary()

print("-----Hourly Intensities-----")
hourly_activity_merged %>% 
  select(total_intensity, average_intensity) %>% 
  drop_na() %>% 
  summary()

print("-----Hourly Steps-----")
hourly_activity_merged %>% 
  select(total_steps) %>% 
  drop_na() %>% 
  summary()
```

##### Minute DataFrames

```{r}
# Summary of Minute DataFrames
print("-----Minute Calories-----")
minute_activity_merged %>% 
  select(calories) %>% 
  drop_na() %>% 
  summary()

print("-----Minute Intensities-----")
minute_activity_merged %>% 
  select(intensity, mets, sleep_state) %>% 
  drop_na() %>% 
  summary()

print("-----Minute Steps-----")
minute_activity_merged %>% 
  select(total_steps) %>% 
  drop_na() %>% 
  summary()
```

#### 3.7.1 Removing 0 Total Steps and 1,440 Sedentary Minutes

The clean_daily_steps summary has revealed that there were 0 steps taken throughout a day. Furthermore, in the clean_daily_intensities dataframe, 1,440 minutes (equivalent to 24 hours) of sedentary time was recorded. This might suggest that some participants may have activated the device but not worn it. This idea is further investigated by comparing the sedentary_minute and total_steps columns.

```{r}
# Comparing the total_steps and sedentary_minutes
daily_activity_merged %>% 
  group_by(id) %>% 
  filter(sedentary_minutes == 1440 & total_steps == 0) %>% 
  select(activity_date_ymd, sedentary_minutes, total_steps) %>% 
  print(n=100)
```

##### Observation

It appears that the 0 number of total steps and 1,440 minutes of sedentary time are related.

##### Actions Taken

Data entries showing 0 total steps and 1,440 minutes of sedentary time will be excluded from the analysis as they indicate inactivity, which could skew the results.

```{r}
# Removing 0 total_steps and 1,440 minutes of sedentary time
daily_activity_merged <- daily_activity_merged[daily_activity_merged$total_steps > 0 & daily_activity_merged$sedentary_minutes < 1400,]
head(daily_activity_merged)
```

#### 3.7.2 Accurate MET Values

The MET values appear to be too high to be correct. According to the Fitbase Data Dictionary, all MET values exported from Fitbase are multiplied by 10. Therefore, to obtain accurate MET values, they will be divided by 10.

## Getting accurate MET values

```{r}
clean_minute_METs <- mutate(clean_minute_METs, mets10 = mets/10)


# Updating Merged Minute DataFrames
minute_activity_m <- merge(clean_minute_calories, clean_minute_intensities, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
minute_activity_m1 <- merge(minute_activity_m, clean_minute_METs, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
minute_activity_m2 <- merge(minute_activity_m1, clean_minute_sleep, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)
minute_activity_merged <- merge(minute_activity_m2, clean_minute_steps, by=c("id", "activity_minute", "activity_minute_ymdhms"), all = TRUE, no.dups = TRUE)

head(clean_minute_METs)
```

### Section 4: Analyse and Share

In this section, the cleaned data will be transformed and organised to identify patterns and to answer key questions relevant to our business task. The results will be visualised and interpreted to facilitate data-driven decisions.

#### 4.1 Summary Statistics

Presented below are summary statistics of the cleaned data, offering a comprehensive overview and providing guidance for the upcoming analysis.

#####Daily DataFrames

```{r}
# Summary of Daily DataFrames
print("-----Daily Calories-----")
daily_activity_merged %>% 
  select(calories) %>% 
  drop_na() %>% 
  summary()

print("-----Daily Intensities-----")
daily_activity_merged %>% 
  select(sedentary_minutes, lightly_active_minutes, fairly_active_minutes, very_active_distance) %>% 
  drop_na() %>% 
  summary()

print("-----Daily Steps-----")
daily_activity_merged %>% 
  select(total_steps) %>% 
  drop_na() %>% 
  summary()

print("-----Daily Sleep-----")
daily_activity_merged %>% 
  select(total_sleep_records, total_minutes_asleep, total_time_in_bed) %>% 
  drop_na() %>% 
  summary()
```

##### Hourly DataFrames

```{r}
# Summary of Hourly DataFrames
print("-----Hourly Calories-----")
hourly_activity_merged %>% 
 select(calories) %>% 
 drop_na() %>% 
 summary()

print("-----Hourly Intensities-----")
hourly_activity_merged %>% 
 select(total_intensity, average_intensity) %>% 
 drop_na() %>% 
 summary()

print("-----Hourly Steps-----")
hourly_activity_merged %>% 
 select(total_steps) %>% 
 drop_na() %>% 
 summary()
```

##### Minute DataFrames

```{r}
# Summary of Minute DataFrames
print("-----Minute Calories-----")
minute_activity_merged %>% 
 select(calories) %>% 
 drop_na() %>% 
 summary()

print("-----Minute Intensities-----")
minute_activity_merged %>% 
 select(intensity, mets10, sleep_state) %>% 
 drop_na() %>% 
 summary()

print("-----Minute Steps-----")
minute_activity_merged %>% 
 select(total_steps) %>% 
 drop_na() %>% 
 summary()
```

##### Key Findings Summary:

1.  **Caloric Burn:** Participants in the study burned an average of 2,372 calories per day. This range is higher than the typical daily caloric burn without exercise, which varies from 1,300 to over 2,000 calories.

2.  **Sedentary Time:** On average, participants were sedentary for about 940.5 minutes per day, or approximately 16 hours. This duration far exceeds the typical daily sedentary time reported for the American population, which is about 7.7 hours. Extended sedentary periods over 10 hours a day are linked to various health issues. High sedentary time in this study could be attributed to factors such as limited exercise spaces, predominantly sedentary occupations, and the widespread use of televisions and other video devices.

3.  **Light Activity:** Participants engaged in light physical activities for an average of 216.5 minutes per day, or nearly 4 hours.

4.  **Moderate Activity:** The average time spent on moderately intense activities was 15.21 minutes per day. This is below the World Health Organization's (WHO) recommended minimum of 21-43 minutes per day.

5.  **Intense Activity:** The average time spent on highly intense activities was 23.73 minutes per day, which is above the WHO's minimum guideline of 11-21 minutes per day.

6.  **Steps:** The average number of steps taken per day was 8,518, which is below the widely recommended target of 10,000 steps per day.

7.  **Sleep:** Participants averaged about 419.3 minutes of sleep per day, which is around 7 hours, meeting the minimum recommended sleep duration for adults.

8.  **METs Value:** The average Metabolic Equivalent of Task (METs) value was 1.034, indicating a high level of sedentary behavior, as METs values of 1.5 or lower characterize sedentary activities.

#### 4.2 Main Topics

Based on the summary statistics, this analysis will focus on:

1.  **Physical Activity and Intensity Levels:** We'll look at how active the participants were, ranging from not active at all (sedentary) to very active. We'll also examine the intensity of these activities, whether they were low, moderate, or high intensity.

2.  **Device Usage Patterns:** We'll explore how frequently and at what times the participants used the device.

#### 4.2.1 Physical Activity and Intensity Levels

It would be worth analysing how physically active the users were and what intensity they used throughout the duration of the study to discover any patterns that could help establish trends in smart device usage.

##### Percentage of Activity Levels

Based on the summary statistics, there is a high amount of time spent being inactive compared to other types of activities. To better understand this, we'll create a pie chart that shows the exact percentage of sedentary time compared to other activities.

```{r,fig.width=12, fig.height=8}
# Percentage of Activity Levels
activity_level_total <- daily_activity_merged %>%
 summarise(
   sedentary_minutes_total = sum(daily_activity_merged$sedentary_minutes, na.rm = TRUE),
   fairly_active_minutes_total = sum(daily_activity_merged$fairly_active_minutes, na.rm = TRUE),
   lightly_active_minutes_total = sum(daily_activity_merged$lightly_active_minutes, na.rm = TRUE),
   very_active_minutes_total = sum(daily_activity_merged$very_active_minutes, na.rm = TRUE))

activity_level <- c(activity_level_total$sedentary_minutes_total, activity_level_total$lightly_active_minutes_total, activity_level_total$fairly_active_minutes_total, activity_level_total$very_active_minutes_total)
labels <- c("inactive", "Lightly Active", "Fairly Active", "Very Active")
colours <- c("#cebdbf", "#e3d4cb", "#996855", "#e7a589")
percentage <- (activity_level/sum(activity_level)*100) %>% 
 round(2)
labels <- paste(labels, percentage)
options(repr.plot.width = 20, repr.plot.height = 700)
pie(activity_level, labels=paste(labels, sep=" ", "%"), col = colours, border = "white", radius = 1, cex = 0.8)
title(main="Percentage of Activity Levels", cex.main = 2, line = 2)
```

###### Key Findings

Most participants, about 78.64%, were inactive during the study, which is concerning because being inactive for long periods can lead to health problems like heart disease, diabetes, and some cancers.

Only 3.25% of the participants actively engaged in exercise (1.27% were fairly active and 1.98% were very active) throughout the 31 days. This suggests that only a few people used the Fitbit mainly to track their workouts, while most used it to monitor their daily routines.

It's likely that many of the participants have jobs that require them to sit a lot or do only light physical activities. According to research by Church and others, more than 80% of jobs in the US are sedentary or involve only light activity.

##### Correlation between Activity Levels and Calories Burnt per Day

To explore potential correlations between activity levels and daily caloric expenditure, a visualisation will be created using ggplot2.

```{r,fig.width=12, fig.height=8}
# Correlation between Activity Level and Calories Burnt
p1 <- ggplot(data = daily_activity_merged, aes(x = sedentary_minutes, y = calories)) + geom_point(color = "#cebdbf") + geom_smooth(method = "lm", color = "#996855", fill = "#e7a589") + xlab("Sedentary Minutes") + ylab("Calories Burnt")
p2 <- ggplot(data = daily_activity_merged, aes(x = lightly_active_minutes, y = calories)) + geom_point(color = "#cebdbf") + geom_smooth(method = "lm", color = "#996855", fill = "#e7a589") + xlab("Lightly Active Minutes") + ylab("Calories Burnt")
p3 <- ggplot(data = daily_activity_merged, aes(x = fairly_active_minutes, y = calories)) + geom_point(color = "#cebdbf") + geom_smooth(method = "lm", color = "#996855", fill = "#e7a589") + xlab("Fairly Active Minutes") + ylab("Calories Burnt")
p4 <- ggplot(data = daily_activity_merged, aes(x = very_active_minutes, y = calories)) + geom_point(color = "#cebdbf") + geom_smooth(method = "lm", color = "#996855", fill = "#e7a589") + xlab("Very Active Minutes") + ylab("Calories Burnt")

options(repr.plot.width = 20, repr.plot.height = 10)
grid.arrange(p1, p2, p3, p4,
            nrow = 1,
            top = "Correlation between Activity Levels and Calories Burnt per Day"
)
```

##### Key Findings

-   The less active a person is, the fewer calories they will burn.
-   The more active a person is, the more calories they will burn.
-   The correlation coefficient between Very Active Minutes and Burnt Calories is 0.61, indicating a moderate level of correlation. Additionally, with a p-value close to 0, this correlation is highly statistically significant.
-   Despite fairly active and very active levels representing the smallest categories, individuals in these activity levels burn more calories compared to those in sedentary and lightly active levels.

##### Average Hourly Physical Intensity Throughout the Day

To discern peak times of physical intensity throughout the day, a bar chart will be generated.

```{r,fig.width=12, fig.height=8}
#Average Hourly Intensity throughout the Day
hourly_activity_merged$activity_hour_hms <- format(hourly_activity_merged$activity_hour_ymdhms, format = "%H:%M:%S")

hourly_activity_merged %>%
 group_by(activity_hour_hms) %>%
 summarise(average_hourly_intensity = mean(total_intensity)) %>% 
 ggplot(aes(x = activity_hour_hms, y = average_hourly_intensity, fill = average_hourly_intensity)) +
 geom_col() + 
 scale_fill_gradient(low = "#cebdbf",
                     high = "#9F7175") +
 labs(x = "Time of Day", y ="Average Intensity", title ="Average Hourly Intensity throughout the Day")+
 theme(plot.title = element_text(size = 20, hjust=0.5, face='bold'),
       axis.text.x = element_text(angle = 90, size = 18), 
       axis.title.x = element_text(size = 20),
       axis.title.y = element_text(size = 20),
       legend.title = element_text(size=20),
       legend.text = element_text(size=18)) +
 guides(fill = guide_legend(title="Average Hourly Intensity"))
options(repr.plot.width = 20, repr.plot.height = 12)
```

##### Key Findings

-   The lowest physical intensities occur from 23:00 to 5:00, corresponding to typical sleeping hour.
-   Peak intensity is observed from 17:00 to 19:00, coinciding with the time when people usually return home from work.
-   Another peak in intensity is observed from 12:00 to 14:00, indicative of lunch breaks.

##### Average Physical Intensity Throughout the Week

To determine the most active day of the week, a weekly bar chart was generated.

```{r,fig.width=12, fig.height=8}
#Average Intensity throughout the Week
hourly_activity_merged$weekday <- factor(hourly_activity_merged$weekday, levels=c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

hourly_activity_merged %>%
 group_by(weekday) %>%
 summarise(average_intensity = mean(total_intensity)) %>% 
 ggplot(aes(x = weekday, y = average_intensity, fill = average_intensity)) +
 geom_col() + 
 scale_fill_gradient(low = "#cebdbf",
                     high = "#9F7175") +
 labs(x = "Day of Week", y ="Average Intensity", title ="Average Intensity throughout the Week")+
 guides(fill = guide_legend(title="Average Intensity")) +
 theme(plot.title = element_text(hjust = 0.5, vjust = 0.8, size = 20, face = 'bold')) +
 theme(axis.text.x = element_text(angle = 90, , size = 14)) +
 theme(axis.title.x = element_text(size = 16),
       axis.title.y = element_text(size = 16),
       legend.title = element_text(size=20),
       legend.text = element_text(size=18))
```

##### Key Findings

-   Saturday emerges as the most active day, likely due to more free time.
-   An unexpected peak in activity is observed on Tuesday, while intensity levels on other weekdays reamin relatively consistent.
-   Sunday shows the lowest activity levels, possibly due to individuals taking rest before the start of the workweek.

##### Average Hourly Physical Intensity Throughout the Week

Below, the average hourly intensity for each day of the week is presented, offering further insights into intensity levels over the week.

```{r,fig.width=12, fig.height=8}
# Average Hourly Intensity throughout the Week
hourly_activity_merged %>%
 group_by(weekday, activity_hour_hms) %>%
 summarise(average_hourly_intensity = mean(total_intensity)) %>% 
 ggplot(aes(x = activity_hour_hms, y = weekday, fill = average_hourly_intensity)) +
 theme(axis.text.x = element_text(angle=90)) +
 scale_fill_continuous(low="white", high = "#9F7175") +
 geom_tile(colour = "white", lwd= .5, linetype = 1) + 
 coord_fixed() + 
 labs(x = "Time of Day", y ="Weekday", title ="Average Hourly Intensity throughout the Week", fill = "Average Hourly Intensity") +
 theme(plot.title = element_text(hjust = 0.5, vjust = 0.8, size = 15, face = 'bold'), panel.background = element_blank()) +
 theme(axis.text.x = element_text(angle = 90, , size = 14)) +
 theme(axis.title.x = element_text(size = 16),
       axis.title.y = element_text(size = 16),
       legend.title = element_text(size=20),
       legend.text = element_text(size=10))
```

##### Key Findings

-   Consistent with earlier observations, intensity peaks from 17:00 to 19:00, post-work hours.
-   The midday peak from 12:00 to 14:00 on weekdays (Monday - Friday) is less pronounced than the previous graph had shown. The peak during that period actually comes from high activity and intensity levels on Saturday when people have more time to workout or do other activities that require higher intensities.
-   Users go to bed and wake up later during weekends.

#### 4.2.2 Device Usage Levels

Daily usage of the device will be examined to understand how users use the device and how often they use it.

##### Daily Device Usage Percentage

To determine device usage frequency, participants will be categorized based on the number of days they used the device. The resulting percentages will be visualised using a pie chart.

```{r}
activity_usage <- daily_activity_merged %>% 
 group_by(id) %>% 
 summarize(days_used = sum(n())) %>% 
 mutate(daily_usage_level = case_when(
   days_used >= 1 & days_used <= 10 ~ 'Low Usage',
   days_used > 10 & days_used <= 20 ~ 'Moderate Usage',
   days_used > 20 ~ 'High Usage'
 )) %>% 
 drop_na() %>% 
 group_by(daily_usage_level) %>% 
 summarize(users_total = n())

head(activity_usage)
```

```{r}
# Daily Device Usage Percentage
slices_v2 <- c(1, 8, 24)
labels_v2 <- c("Low Usage", "Moderate Usage", "High Usage")
pct <- slices_v2/sum(slices_v2)*100
pct <- round(pct, 2)
labels_v2 <- paste(labels_v2, pct)
labels_v2 <- paste(labels_v2, "%", sep = "")
colours <- c("#996855", "#e7a589", "#cebdbf")
options(repr.plot.width = 20, repr.plot.height = 13)
pie(slices_v2, labels = labels_v2,
    main="Daily Usage Levels",
    col = colours, 
    border = "white", 
    cex.main = 2,
    cex = 0.8,
    radius = 1)
legend('topleft', c("Low Usage: 1 - 10 days","Moderate Usage: 11 - 20 days","High Usage: 21 - 31 days"), cex = 0.5, fill = colours)
```

##### Device Worn in a Day Percentage

The pie chart below illustrates the percentage with which the device was worn all day.

```{r}
daily_activity_merged$device_worn <- daily_activity_merged$sedentary_minutes + daily_activity_merged$fairly_active_minutes + daily_activity_merged$lightly_active_minutes + daily_activity_merged$very_active_minutes
daily_activity_merged$device_worn <- daily_activity_merged$device_worn/60
daily_activity_merged$device_worn_24 <- daily_activity_merged$device_worn == 24
device_worn <- count(daily_activity_merged, device_worn_24) %>% 
  drop_na()

glimpse(device_worn)
```


```{r}
slices_v3 <- c(378, 458)
labels_v3 <- c("Worn all day", "Not worn all day")
pct_v1 <- slices_v3/sum(slices_v3)*100
pct_v1 <- round(pct_v1, 2)
labels_v3 <- paste(labels_v3, pct_v1)
labels_v3 <- paste(labels_v3, "%", sep = "")
colours <- c("#996855", "#cebdbf")
options(repr.plot.width = 20, repr.plot.height = 13)
pie(slices_v3, labels = labels_v3,
    main="Percentage of the Device Being Worn the Whole Day", cex = 1, cex.main = 1.4, col = colours, border = "white", radius = 1)
```

###### Key Findings

-   54.78% of participants did not wear the device for the entire day.

##### The Number of Hours the Device was Worn Throughout the Week

Given that over 50% of participants did not wear the device for the entire 24 hours per day, it is pertinent to examine the number of hours the device was worn per day.

```{r }
# How many Hours was the Device Worn per Day
device_worn_24_7 <- daily_activity_merged[c("id", "weekday", "device_worn", "activity_date_ymd")]
device_worn_24_7$weekday <- factor(device_worn_24_7$weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

device_worn_24_7 %>% 
  drop_na() %>% 
  ggplot(aes(y = device_worn, x = weekday, group = 1)) + 
  geom_point(color = "#cebdbf", size = 1) +
  geom_smooth(method = "loess", span = 0.2, color = "#996855", fill = "#e7a589") +
  coord_cartesian(ylim = c(0, 24)) +
  ggtitle("The Number of Hours the Device was Worn \nthroughout the Week")+
  ylab("The Number of Hours Worn within a Day") +
  xlab("Day of Week") +
  theme(plot.title = element_text(size = 20, hjust = 0.5, face = 'bold'),
        axis.text.x = element_text(angle = 90, size = 14), 
        axis.title.x = element_text(size = 16),
        axis.title.y = element_text(size = 16)
        )
options(repr.plot.width = 25, repr.plot.height = 12)
```

It appears that many participants wore the tracker for less than 20 hours per day. To determine the exact percentage of how many times the device was worn for less than 20 hours per day, the count() function will be used and a pie chart will be created.

```{r}
# Count of the device being worn < 20 hours
worn_less_20 <- daily_activity_merged %>% 
  count(device_worn < 20) %>% 
  drop_na()

head(worn_less_20)
```

```{r}
# Percentage of the device being worn < 20 hours
slices_v3 <- c(406, 433)
labels_v3 <- c("Device worn < 20 hours", "Device worn > 20 hours")
pct_v1 <- slices_v3/sum(slices_v3)*100
pct_v1 <- round(pct_v1, 2)
labels_v3 <- paste(labels_v3, pct_v1)
labels_v3 <- paste(labels_v3, "%", sep = "")
colours <- c("#996855", "#cebdbf")
options(repr.plot.width = 20, repr.plot.height = 13)
pie(slices_v3, labels = labels_v3,
    main = "Percentage of the Device Being Worn \nLess than 20 Hours per Day", col = colours, border = "white", radius = 1,
   cex.main = 1, cex = 1)
```

#####Key Findings - A significant portion of participants did not wear the device for the entire day during the study. - 48.39% of participants wore the device for less than 20 hours per day.

##### Activity Device Usage vs Sleep Device Usage

Given that almost half of the participants wore the device for less than 20 hours per day, it is plausible that these unaccounted hours correspond to sleep periods when users may remove the device for comfort. To investigate this hypothesis, two bar graphs will be plotted comparing activity usage levels (users tracking their daily activity) and sleep usage levels (users tracking their sleep).

```{r}
# Activity usage per participant
activity_usage_v2 <- clean_daily_calories %>% 
  group_by(id) %>% 
  count() %>% 
  arrange(n) %>%
  mutate(activity_percentage = (n/31)*100)
head(activity_usage_v2)

p5 <- ggplot(activity_usage_v2, aes(x = reorder(id, n), y = activity_percentage)) +
  geom_col(fill = "#cebdbf")  + 
  labs(title="Activity Device Usage", x = "Particpant #", y = "Percentage of Logged Activity", caption = "33 participants") +
  theme(plot.title = element_text(hjust = 0.5, vjust = 0.8, size = 10, face = 'bold')) +
  theme(axis.text.x = element_text(angle = 90, size = 8)) +
  theme(axis.title.x = element_text(size = 5)) +
  theme(axis.title.y = element_text(size = 8)) + 
  theme(plot.caption = element_text(size = 6))

# Sleep usage per participant
sleep_usage <- clean_daily_sleep %>% 
  group_by(id) %>% 
  count() %>% 
  arrange(n) %>%
  mutate(sleep_percentage = (n/31)*100) #% of nights users monitored sleep
head(sleep_usage)

p6 <- ggplot(sleep_usage, aes(x= reorder(id, n), y = sleep_percentage)) +
  geom_col(fill = "#cebdbf") + 
  labs(title="Sleep Device Usage", x= "Particpant #", y="Percentage of Logged Sleep", caption = "24 participants") +
  theme(plot.title = element_text(hjust = 0.5, vjust = 0.8, size = 10, face = 'bold')) +
  theme(axis.text.x = element_text(angle = 90, size = 8)) +
  theme(axis.title.x = element_text(size = 5)) +
  theme(axis.title.y = element_text(size = 8)) +
  theme(plot.caption = element_text(size = 6))

options(repr.plot.width = 20, repr.plot.height = 12)
grid.arrange(p5, p6,
             ncol = 1
)
```

##### Key Findings

-   33 participants tracked their daily activity, whereas 24 participants tracked their sleep. This indicates that all participants tracked their daily activity, but 9 of them did not track their sleep.
-   Over 21 participants wore the device throughout the whole day to track their daily activity, but only 3 wore it to bed consistently during the study. This suggests that many users remove their Fitbit tracker before sleeping.

### Section 5: Act

#### Bellabeat Marketing Strategy Recommendations

##### personalised Workout Schedule for Female Working Professionals

Many Bellabeat customers are working professionals who might often be too busy to engage in regular exercise. Studies propose that people with fewer opportunities for daily workouts during their work week can either workout for longer periods during the weekends and/or work for shorter periods during the week to maintain the recommended 75 - 150 minutes of moderate to vigorous activity a week. Bellabeat can provide personalised workout schedules that would not only reach the recommended amount of activity but also accommodate the user's busy schedule.

##### Gentle Reminders and Inactivity Alerts

To reduce the amount of sedentary time, Bellabeat added the inactivity alert feature which sends out alerts to the users when they have been inactive for too long, to remind them to get up and move around. This feature, however, is only available to Leaf and Time but not the Ivy tracker. Since Ivy focuses on wellness, vibrations and reminders might be too distracting which can induce anxiety. Instead, Ivy allows users to set their own daily goals for steps and activity to motivate them to make better choices for their health. However, knowing that the target market are female professionals who might be involved in daily prolonged sitting, gentle inactivity alerts should still be an option as high sedentary behaviour has negative health effects.

##### Comfortable and Lightweight

Despite the importance of sleep tracking, some Fitbit users took off their tracking device during the night as they found it uncomfortable to sleep with. The marketing team should emphasise that Bellabeat Ivy is incredibly lightweight making it very comfortable to wear anywhere and anytime including to bed.

##### Strong Battery Life

Bellabeat Ivy also boasts a long battery life that can last up to 8 days. Therefore, users would have to worry less about recharging the device overnight.

##Conclusion 

The purpose of this case study was to identify potential growth opportunities for Bellabeat, a wellness company, and improve their marketing strategy by analysing smart device usage among Fitbit consumers. Based on the analysis conducted, it can be concluded that the majority of fitness smart device users are working professionals who lack the recommended active minutes as they are often too busy to engage in regular exercise. Therefore, it is recommended to tailor Bellabeat's marketing strategies and products to working professionals by providing personalised workout schedules as well as implementing gentle inactivity alerts. Moreover, it was suggested to emphasise the importance of sleep because of its numerous benefits. These are the recommendations and conclusions drawn from the analysis of the Fitbit data. However, further analysis into other smart device companies such as the Apple Watch or Garmin is advised to support these results and provide additional insight into Bellabeat's strategies.


